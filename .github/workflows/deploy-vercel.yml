name: ğŸš€ Auto Deploy to Vercel

on:
    push:
        branches:
            - main
            - develop
    pull_request:
        branches:
            - main

env:
    VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
    VERCEL_PROJECT_ID_WEB: ${{ secrets.VERCEL_PROJECT_ID_WEB }}
    VERCEL_PROJECT_ID_STUDIO: ${{ secrets.VERCEL_PROJECT_ID_STUDIO }}

jobs:
    # Job 1: Deploy Web App
    deploy-web:
        name: ğŸŒ Deploy Web App
        runs-on: ubuntu-latest
        steps:
            - name: ğŸ“¥ Checkout Code
              uses: actions/checkout@v4

            - name: ğŸ“¦ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "18"
                  cache: "npm"

            - name: ğŸ“¥ Install Vercel CLI
              run: npm install -g vercel@latest

            - name: ğŸ”— Pull Vercel Environment (Production)
              if: github.ref == 'refs/heads/main'
              run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/web

            - name: ğŸ”— Pull Vercel Environment (Preview)
              if: github.ref != 'refs/heads/main'
              run: vercel pull --yes --environment=preview --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/web

            - name: ğŸ”¨ Build Project Artifacts
              run: vercel build ${{ github.ref == 'refs/heads/main' && '--prod' || '' }} --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/web

            - name: ğŸš€ Deploy to Vercel (Production)
              if: github.ref == 'refs/heads/main'
              run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/web

            - name: ğŸš€ Deploy to Vercel (Preview)
              if: github.ref != 'refs/heads/main'
              run: vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/web

    # Job 2: Deploy Studio
    deploy-studio:
        name: ğŸ¨ Deploy Studio
        runs-on: ubuntu-latest
        steps:
            - name: ğŸ“¥ Checkout Code
              uses: actions/checkout@v4

            - name: ğŸ“¦ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "18"
                  cache: "npm"

            - name: ğŸ“¥ Install Vercel CLI
              run: npm install -g vercel@latest

            - name: ğŸ”— Pull Vercel Environment (Production)
              if: github.ref == 'refs/heads/main'
              run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/studio

            - name: ğŸ”— Pull Vercel Environment (Preview)
              if: github.ref != 'refs/heads/main'
              run: vercel pull --yes --environment=preview --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/studio

            - name: ğŸ”¨ Build Project Artifacts
              run: vercel build ${{ github.ref == 'refs/heads/main' && '--prod' || '' }} --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/studio

            - name: ğŸš€ Deploy to Vercel (Production)
              if: github.ref == 'refs/heads/main'
              run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/studio

            - name: ğŸš€ Deploy to Vercel (Preview)
              if: github.ref != 'refs/heads/main'
              run: vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }}
              working-directory: ./apps/studio
